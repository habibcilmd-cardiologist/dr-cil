{{/*
=============================================================================
Dr. Habib ÇİL - Unified Schema Generation (@graph)
Replaces fragile $skipSchema logic with a robust graph-based approach.
Collects all schemas into a single JSON-LD script.
=============================================================================
*/}}
{{ $schemaGraph := slice }}

{{/* 1. WebSite Schema (Global) */}}
{{ $websiteSchema := dict
"@type" "WebSite"
"@id" (printf "%s#website" site.Home.Permalink)
"name" site.Title
"url" site.Home.Permalink
"publisher" (dict "@type" "Person" "name" site.Params.Author.name)
}}
{{ with .Site.Params.description }}{{ $websiteSchema = merge $websiteSchema (dict "description" .) }}{{ end }}
{{ with .Site.LanguageCode }}{{ $websiteSchema = merge $websiteSchema (dict "inLanguage" .) }}{{ end }}
{{ $schemaGraph = $schemaGraph | append $websiteSchema }}

{{/* 2. Breadcrumb Schema (All Pages except Home) */}}
{{ if and (not .IsHome) (site.Params.enableStructuredBreadcrumbs | default false) }}
{{ $breadcrumbs := slice }}
{{ range .Ancestors }}
{{ if not .IsHome }}
{{ $breadcrumbs = $breadcrumbs | append . }}
{{ end }}
{{ end }}
{{ $breadcrumbs = $breadcrumbs | append . }}

{{ $itemListElement := slice }}
{{ range $index, $element := $breadcrumbs }}
{{ $itemListElement = $itemListElement | append (dict
"@type" "ListItem"
"position" (add $index 1)
"name" .Title
"item" .Permalink
) }}
{{ end }}

{{ $breadcrumbSchema := dict
"@type" "BreadcrumbList"
"@id" (printf "%s#breadcrumb" .Permalink)
"itemListElement" $itemListElement
}}
{{ $schemaGraph = $schemaGraph | append $breadcrumbSchema }}
{{ end }}

{{/* 3. Article Schema (Standard Pages) */}}
{{/* Logic: If NOT a specialized page (service, clinic, blog, publication), add generic Article */}}
{{ $isSpecializedPage := false }}
{{ if or (in .Path "blog") (in .Path "hizmetler") (in .Path "services") (in .Path "klinik") (in .Path "clinic") (eq
.Section "yayinlar") }}
{{ $isSpecializedPage = true }}
{{ end }}

{{ if and (not .IsHome) (not $isSpecializedPage) }}
{{ $iso8601 := "2006-01-02T15:04:05-07:00" }}
{{ $articleSchema := dict
"@type" "Article"
"@id" (printf "%s#article" .Permalink)
"isPartOf" (dict "@id" (printf "%s#website" site.Home.Permalink))
"headline" .Title
"name" .Title
"mainEntityOfPage" .Permalink
"url" .Permalink
"author" (dict "@type" "Person" "name" site.Params.Author.name)
"wordCount" .WordCount
}}
{{ with .Description }}{{ $articleSchema = merge $articleSchema (dict "description" .) }}{{ end }}
{{ with .PublishDate }}{{ $articleSchema = merge $articleSchema (dict "datePublished" (.Format $iso8601)) }}{{ end }}
{{ with .Lastmod }}{{ $articleSchema = merge $articleSchema (dict "dateModified" (.Format $iso8601)) }}{{ end }}

{{ $schemaGraph = $schemaGraph | append $articleSchema }}
{{ end }}

{{/* 4. Output the Graph */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": {{ $schemaGraph | jsonify }}
}
</script>

{{/* Include Specialized Partials - These usually output their own
<script> tags */}}
  { { partial "schema-scholarly.html". } }
  { { partial "schema-procedure.html". } }
  { { partial "schema-faq.html". } }